
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Step-6: Advanced PFASST controllers &#8212; pySDC 2 documentation</title>
    <link rel="stylesheet" href="../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Step-7: Advanced topics" href="step_7.html" />
    <link rel="prev" title="Step-5: PFASST" href="step_5.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="step_7.html" title="Step-7: Advanced topics"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="step_5.html" title="Step-5: PFASST"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">pySDC 2 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="step-6-advanced-pfasst-controllers">
<h1>Step-6: Advanced PFASST controllers<a class="headerlink" href="#step-6-advanced-pfasst-controllers" title="Permalink to this headline">¶</a></h1>
<p>We discuss controller implementations and features besides the standard classic and serial PFASST controller in this step.</p>
<div class="section" id="part-a-classical-vs-multigrid-controller">
<h2>Part A: Classical vs. multigrid controller<a class="headerlink" href="#part-a-classical-vs-multigrid-controller" title="Permalink to this headline">¶</a></h2>
<p>Besides the <code class="docutils literal notranslate"><span class="pre">allinclusive_classic_nonMPI</span></code> controller we have used so far, pySDC comes with (at least) three more controllers.
While we do not discuss MPI-based controllers here, the other major branch is the multigrid controller.
In contrast to the classical scheme, this implementation of PFASST does not overlap communication and computation as the classical implementation does.
It resembles more closely a multigrid-in-time algorithm by performing each stage for all processes at once (i.e. fine sweep, restrict, coarse sweep, interpolate, etc.).
Consequently, processes can only finish all at once.</p>
<p>Important things to note:</p>
<ul class="simple">
<li>If only SDC or MLSDC are run, classical and multigrid controller do not differ.
The difference is only in the communication scheme and the stopping criterion for multiple processes.</li>
<li>One major advantage of having the multigrid controller at hand is that some MPI implementations on certain machines do not work well with overlapping.</li>
<li>The multigrid controller cannot handle multi-step SDC (see step 7) due to design decisions.</li>
</ul>
<p>Full code: <a class="reference external" href="https://github.com/Parallel-in-Time/pySDC/blob/master/pySDC/tutorial/step_6/A_classic_vs_multigrid_controller.py">pySDC/tutorial/step_6/A_classic_vs_multigrid_controller.py</a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pySDC.implementations.problem_classes.HeatEquation_1D_FD</span> <span class="k">import</span> <span class="n">heat1d</span>
<span class="kn">from</span> <span class="nn">pySDC.implementations.datatype_classes.mesh</span> <span class="k">import</span> <span class="n">mesh</span>
<span class="kn">from</span> <span class="nn">pySDC.implementations.collocation_classes.gauss_radau_right</span> <span class="k">import</span> <span class="n">CollGaussRadau_Right</span>
<span class="kn">from</span> <span class="nn">pySDC.implementations.sweeper_classes.generic_LU</span> <span class="k">import</span> <span class="n">generic_LU</span>
<span class="kn">from</span> <span class="nn">pySDC.implementations.transfer_classes.TransferMesh</span> <span class="k">import</span> <span class="n">mesh_to_mesh</span>
<span class="kn">from</span> <span class="nn">pySDC.implementations.controller_classes.allinclusive_classic_nonMPI</span> <span class="k">import</span> <span class="n">allinclusive_classic_nonMPI</span>
<span class="kn">from</span> <span class="nn">pySDC.implementations.controller_classes.allinclusive_multigrid_nonMPI</span> <span class="k">import</span> <span class="n">allinclusive_multigrid_nonMPI</span>

<span class="kn">from</span> <span class="nn">pySDC.helpers.stats_helper</span> <span class="k">import</span> <span class="n">filter_stats</span><span class="p">,</span> <span class="n">sort_stats</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">num_proc_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">multi_level</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A simple test program to compare classical and multigrid PFASST runs</span>

<span class="sd">    Args:</span>
<span class="sd">        num_proc_list: list of number of processes to test with</span>
<span class="sd">        fname: filename/path for output</span>
<span class="sd">        multi_level (bool): do multi-level run or single-level</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">multi_level</span><span class="p">:</span>
        <span class="n">description</span><span class="p">,</span> <span class="n">controller_params</span><span class="p">,</span> <span class="n">t0</span><span class="p">,</span> <span class="n">Tend</span> <span class="o">=</span> <span class="n">set_parameters_ml</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="n">num_proc</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">num_proc</span> <span class="ow">in</span> <span class="n">num_proc_list</span><span class="p">),</span> \
            <span class="s1">&#39;ERROR: single-elevel run can only use 1 processor, got </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">num_proc_list</span>
        <span class="n">description</span><span class="p">,</span> <span class="n">controller_params</span><span class="p">,</span> <span class="n">t0</span><span class="p">,</span> <span class="n">Tend</span> <span class="o">=</span> <span class="n">set_parameters_sl</span><span class="p">()</span>

    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="c1"># loop over different numbers of processes</span>
    <span class="k">for</span> <span class="n">num_proc</span> <span class="ow">in</span> <span class="n">num_proc_list</span><span class="p">:</span>

        <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;Working with </span><span class="si">%2i</span><span class="s1"> processes...&#39;</span> <span class="o">%</span> <span class="n">num_proc</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>

        <span class="c1"># instantiate controllers</span>
        <span class="n">controller_classic</span> <span class="o">=</span> <span class="n">allinclusive_classic_nonMPI</span><span class="p">(</span><span class="n">num_procs</span><span class="o">=</span><span class="n">num_proc</span><span class="p">,</span> <span class="n">controller_params</span><span class="o">=</span><span class="n">controller_params</span><span class="p">,</span>
                                                         <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">)</span>
        <span class="n">controller_multigrid</span> <span class="o">=</span> <span class="n">allinclusive_multigrid_nonMPI</span><span class="p">(</span><span class="n">num_procs</span><span class="o">=</span><span class="n">num_proc</span><span class="p">,</span> <span class="n">controller_params</span><span class="o">=</span><span class="n">controller_params</span><span class="p">,</span>
                                                             <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">)</span>

        <span class="c1"># get initial values on finest level</span>
        <span class="n">P</span> <span class="o">=</span> <span class="n">controller_classic</span><span class="o">.</span><span class="n">MS</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">levels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">prob</span>
        <span class="n">uinit</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">u_exact</span><span class="p">(</span><span class="n">t0</span><span class="p">)</span>

        <span class="c1"># call main functions to get things done...</span>
        <span class="n">uend_classic</span><span class="p">,</span> <span class="n">stats_classic</span> <span class="o">=</span> <span class="n">controller_classic</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">u0</span><span class="o">=</span><span class="n">uinit</span><span class="p">,</span> <span class="n">t0</span><span class="o">=</span><span class="n">t0</span><span class="p">,</span> <span class="n">Tend</span><span class="o">=</span><span class="n">Tend</span><span class="p">)</span>
        <span class="n">uend_multigrid</span><span class="p">,</span> <span class="n">stats_multigrid</span> <span class="o">=</span> <span class="n">controller_multigrid</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">u0</span><span class="o">=</span><span class="n">uinit</span><span class="p">,</span> <span class="n">t0</span><span class="o">=</span><span class="n">t0</span><span class="p">,</span> <span class="n">Tend</span><span class="o">=</span><span class="n">Tend</span><span class="p">)</span>

        <span class="c1"># compute exact solution and compare with both results</span>
        <span class="n">uex</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">u_exact</span><span class="p">(</span><span class="n">Tend</span><span class="p">)</span>
        <span class="n">err_classic</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">uex</span> <span class="o">-</span> <span class="n">uend_classic</span><span class="p">)</span>
        <span class="n">err_multigrid</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">uex</span> <span class="o">-</span> <span class="n">uend_multigrid</span><span class="p">)</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">uend_classic</span> <span class="o">-</span> <span class="n">uend_multigrid</span><span class="p">)</span>

        <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;Error classic: </span><span class="si">%12.8e</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">err_classic</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;Error multigrid: </span><span class="si">%12.8e</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">err_multigrid</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;Diff: </span><span class="si">%6.4e</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">diff</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>

        <span class="c1"># filter statistics by type (number of iterations)</span>
        <span class="n">filtered_stats_classic</span> <span class="o">=</span> <span class="n">filter_stats</span><span class="p">(</span><span class="n">stats_classic</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;niter&#39;</span><span class="p">)</span>
        <span class="n">filtered_stats_multigrid</span> <span class="o">=</span> <span class="n">filter_stats</span><span class="p">(</span><span class="n">stats_multigrid</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;niter&#39;</span><span class="p">)</span>

        <span class="c1"># convert filtered statistics to list of iterations count, sorted by process</span>
        <span class="n">iter_counts_classic</span> <span class="o">=</span> <span class="n">sort_stats</span><span class="p">(</span><span class="n">filtered_stats_classic</span><span class="p">,</span> <span class="n">sortby</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
        <span class="n">iter_counts_multigrid</span> <span class="o">=</span> <span class="n">sort_stats</span><span class="p">(</span><span class="n">filtered_stats_multigrid</span><span class="p">,</span> <span class="n">sortby</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>

        <span class="c1"># compute and print statistics</span>
        <span class="k">for</span> <span class="n">item_classic</span><span class="p">,</span> <span class="n">item_multigrid</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">iter_counts_classic</span><span class="p">,</span> <span class="n">iter_counts_multigrid</span><span class="p">):</span>
            <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;Number of iterations for time </span><span class="si">%4.2f</span><span class="s1"> (classic/multigrid): </span><span class="si">%1i</span><span class="s1"> / </span><span class="si">%1i</span><span class="s1">&#39;</span> <span class="o">%</span> \
                  <span class="p">(</span><span class="n">item_classic</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">item_classic</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">item_multigrid</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">num_proc</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">item_classic</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">item_multigrid</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> \
                    <span class="s1">&#39;ERROR: number of iterations differ between classic and multigrid controller by </span><span class="si">%2i</span><span class="s1">&#39;</span> \
                    <span class="o">%</span> <span class="p">(</span><span class="n">item_classic</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">item_multigrid</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">()</span>

        <span class="k">assert</span> <span class="nb">all</span><span class="p">([</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">8</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">iter_counts_multigrid</span><span class="p">]),</span> \
            <span class="s2">&quot;ERROR: weird iteration counts for multigrid, got </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">iter_counts_multigrid</span>
        <span class="k">assert</span> <span class="n">diff</span> <span class="o">&lt;</span> <span class="mf">3.5E-09</span><span class="p">,</span> <span class="s2">&quot;ERROR: difference between classic and multigrid controller is too large, got </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">diff</span>

    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">set_parameters_ml</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper routine to set parameters for the following multi-level runs</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: dictionary containing the simulation parameters</span>
<span class="sd">        dict: dictionary containing the controller parameters</span>
<span class="sd">        float: starting time</span>
<span class="sd">        float: end time</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># initialize level parameters</span>
    <span class="n">level_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">level_params</span><span class="p">[</span><span class="s1">&#39;restol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">5E-10</span>
    <span class="n">level_params</span><span class="p">[</span><span class="s1">&#39;dt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.125</span>

    <span class="c1"># initialize sweeper parameters</span>
    <span class="n">sweeper_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">sweeper_params</span><span class="p">[</span><span class="s1">&#39;collocation_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CollGaussRadau_Right</span>
    <span class="n">sweeper_params</span><span class="p">[</span><span class="s1">&#39;num_nodes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">]</span>

    <span class="c1"># initialize problem parameters</span>
    <span class="n">problem_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">problem_params</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.1</span>  <span class="c1"># diffusion coefficient</span>
    <span class="n">problem_params</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># frequency for the test value</span>
    <span class="n">problem_params</span><span class="p">[</span><span class="s1">&#39;nvars&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">63</span><span class="p">,</span> <span class="mi">31</span><span class="p">]</span>  <span class="c1"># number of degrees of freedom for each level</span>

    <span class="c1"># initialize step parameters</span>
    <span class="n">step_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">step_params</span><span class="p">[</span><span class="s1">&#39;maxiter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50</span>

    <span class="c1"># initialize space transfer parameters</span>
    <span class="n">space_transfer_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">space_transfer_params</span><span class="p">[</span><span class="s1">&#39;rorder&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">space_transfer_params</span><span class="p">[</span><span class="s1">&#39;iorder&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6</span>

    <span class="c1"># initialize controller parameters</span>
    <span class="n">controller_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">controller_params</span><span class="p">[</span><span class="s1">&#39;logger_level&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30</span>

    <span class="c1"># fill description dictionary for easy step instantiation</span>
    <span class="n">description</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;problem_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">heat1d</span>  <span class="c1"># pass problem class</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;problem_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">problem_params</span>  <span class="c1"># pass problem parameters</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;dtype_u&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mesh</span>  <span class="c1"># pass data type for u</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;dtype_f&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mesh</span>  <span class="c1"># pass data type for f</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;sweeper_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">generic_LU</span>  <span class="c1"># pass sweeper</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;sweeper_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sweeper_params</span>  <span class="c1"># pass sweeper parameters</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;level_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">level_params</span>  <span class="c1"># pass level parameters</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;step_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">step_params</span>  <span class="c1"># pass step parameters</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;space_transfer_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mesh_to_mesh</span>  <span class="c1"># pass spatial transfer class</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;space_transfer_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">space_transfer_params</span>  <span class="c1"># pass paramters for spatial transfer</span>

    <span class="c1"># set time parameters</span>
    <span class="n">t0</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">Tend</span> <span class="o">=</span> <span class="mf">1.0</span>

    <span class="k">return</span> <span class="n">description</span><span class="p">,</span> <span class="n">controller_params</span><span class="p">,</span> <span class="n">t0</span><span class="p">,</span> <span class="n">Tend</span>


<span class="k">def</span> <span class="nf">set_parameters_sl</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper routine to set parameters for the following multi-level runs</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: dictionary containing the simulation parameters</span>
<span class="sd">        dict: dictionary containing the controller parameters</span>
<span class="sd">        float: starting time</span>
<span class="sd">        float: end time</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># initialize level parameters</span>
    <span class="n">level_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">level_params</span><span class="p">[</span><span class="s1">&#39;restol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">5E-10</span>
    <span class="n">level_params</span><span class="p">[</span><span class="s1">&#39;dt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.125</span>

    <span class="c1"># initialize sweeper parameters</span>
    <span class="n">sweeper_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">sweeper_params</span><span class="p">[</span><span class="s1">&#39;collocation_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CollGaussRadau_Right</span>
    <span class="n">sweeper_params</span><span class="p">[</span><span class="s1">&#39;num_nodes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>

    <span class="c1"># initialize problem parameters</span>
    <span class="n">problem_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">problem_params</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.1</span>  <span class="c1"># diffusion coefficient</span>
    <span class="n">problem_params</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># frequency for the test value</span>
    <span class="n">problem_params</span><span class="p">[</span><span class="s1">&#39;nvars&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">63</span>  <span class="c1"># number of degrees of freedom for each level</span>

    <span class="c1"># initialize step parameters</span>
    <span class="n">step_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">step_params</span><span class="p">[</span><span class="s1">&#39;maxiter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50</span>

    <span class="c1"># initialize controller parameters</span>
    <span class="n">controller_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">controller_params</span><span class="p">[</span><span class="s1">&#39;logger_level&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30</span>

    <span class="c1"># fill description dictionary for easy step instantiation</span>
    <span class="n">description</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;problem_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">heat1d</span>  <span class="c1"># pass problem class</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;problem_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">problem_params</span>  <span class="c1"># pass problem parameters</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;dtype_u&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mesh</span>  <span class="c1"># pass data type for u</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;dtype_f&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mesh</span>  <span class="c1"># pass data type for f</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;sweeper_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">generic_LU</span>  <span class="c1"># pass sweeper</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;sweeper_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sweeper_params</span>  <span class="c1"># pass sweeper parameters</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;level_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">level_params</span>  <span class="c1"># pass level parameters</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;step_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">step_params</span>  <span class="c1"># pass step parameters</span>

    <span class="c1"># set time parameters</span>
    <span class="n">t0</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">Tend</span> <span class="o">=</span> <span class="mf">1.0</span>

    <span class="k">return</span> <span class="n">description</span><span class="p">,</span> <span class="n">controller_params</span><span class="p">,</span> <span class="n">t0</span><span class="p">,</span> <span class="n">Tend</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">(</span><span class="n">num_proc_list</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">fname</span><span class="o">=</span><span class="s1">&#39;step_6_A_sl_out.txt&#39;</span><span class="p">,</span> <span class="n">multi_level</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">main</span><span class="p">(</span><span class="n">num_proc_list</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span> <span class="n">fname</span><span class="o">=</span><span class="s1">&#39;step_6_A_ml_out.txt&#39;</span><span class="p">,</span> <span class="n">multi_level</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Results:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Working</span> <span class="k">with</span>  <span class="mi">1</span> <span class="n">processes</span><span class="o">...</span>
<span class="n">Error</span> <span class="n">classic</span><span class="p">:</span> <span class="mf">6.15510653e-05</span>
<span class="n">Error</span> <span class="n">multigrid</span><span class="p">:</span> <span class="mf">6.15510653e-05</span>
<span class="n">Diff</span><span class="p">:</span> <span class="mf">0.0000e+00</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.00</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">8</span> <span class="o">/</span> <span class="mi">8</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.12</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">8</span> <span class="o">/</span> <span class="mi">8</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.25</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">8</span> <span class="o">/</span> <span class="mi">8</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.38</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">8</span> <span class="o">/</span> <span class="mi">8</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.50</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">7</span> <span class="o">/</span> <span class="mi">7</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.62</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">7</span> <span class="o">/</span> <span class="mi">7</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.75</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">7</span> <span class="o">/</span> <span class="mi">7</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.88</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">7</span> <span class="o">/</span> <span class="mi">7</span>

</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Working</span> <span class="k">with</span>  <span class="mi">1</span> <span class="n">processes</span><span class="o">...</span>
<span class="n">Error</span> <span class="n">classic</span><span class="p">:</span> <span class="mf">6.15508919e-05</span>
<span class="n">Error</span> <span class="n">multigrid</span><span class="p">:</span> <span class="mf">6.15508919e-05</span>
<span class="n">Diff</span><span class="p">:</span> <span class="mf">0.0000e+00</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.00</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">5</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.12</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">5</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.25</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">4</span> <span class="o">/</span> <span class="mi">4</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.38</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">4</span> <span class="o">/</span> <span class="mi">4</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.50</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">4</span> <span class="o">/</span> <span class="mi">4</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.62</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">4</span> <span class="o">/</span> <span class="mi">4</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.75</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">3</span> <span class="o">/</span> <span class="mi">3</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.88</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">3</span> <span class="o">/</span> <span class="mi">3</span>

<span class="n">Working</span> <span class="k">with</span>  <span class="mi">2</span> <span class="n">processes</span><span class="o">...</span>
<span class="n">Error</span> <span class="n">classic</span><span class="p">:</span> <span class="mf">6.15520691e-05</span>
<span class="n">Error</span> <span class="n">multigrid</span><span class="p">:</span> <span class="mf">6.15507639e-05</span>
<span class="n">Diff</span><span class="p">:</span> <span class="mf">1.3052e-09</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.00</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">5</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.12</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">5</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.25</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">4</span> <span class="o">/</span> <span class="mi">5</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.38</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">5</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.50</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">4</span> <span class="o">/</span> <span class="mi">4</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.62</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">4</span> <span class="o">/</span> <span class="mi">4</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.75</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">3</span> <span class="o">/</span> <span class="mi">4</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.88</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">4</span> <span class="o">/</span> <span class="mi">4</span>

<span class="n">Working</span> <span class="k">with</span>  <span class="mi">4</span> <span class="n">processes</span><span class="o">...</span>
<span class="n">Error</span> <span class="n">classic</span><span class="p">:</span> <span class="mf">6.15511879e-05</span>
<span class="n">Error</span> <span class="n">multigrid</span><span class="p">:</span> <span class="mf">6.15508277e-05</span>
<span class="n">Diff</span><span class="p">:</span> <span class="mf">3.6024e-10</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.00</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">6</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.12</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">6</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.25</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">6</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.38</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">6</span> <span class="o">/</span> <span class="mi">6</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.50</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">4</span> <span class="o">/</span> <span class="mi">5</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.62</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">4</span> <span class="o">/</span> <span class="mi">5</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.75</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">5</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.88</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">5</span>

<span class="n">Working</span> <span class="k">with</span>  <span class="mi">8</span> <span class="n">processes</span><span class="o">...</span>
<span class="n">Error</span> <span class="n">classic</span><span class="p">:</span> <span class="mf">6.15540230e-05</span>
<span class="n">Error</span> <span class="n">multigrid</span><span class="p">:</span> <span class="mf">6.15508175e-05</span>
<span class="n">Diff</span><span class="p">:</span> <span class="mf">3.2055e-09</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.00</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">7</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.12</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">7</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.25</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">7</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.38</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">6</span> <span class="o">/</span> <span class="mi">7</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.50</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">6</span> <span class="o">/</span> <span class="mi">7</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.62</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">6</span> <span class="o">/</span> <span class="mi">7</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.75</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">6</span> <span class="o">/</span> <span class="mi">7</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.88</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">7</span> <span class="o">/</span> <span class="mi">7</span>

</pre></div>
</div>
</div>
<div class="section" id="part-b-odd-temporal-distribution">
<h2>Part B: Odd temporal distribution<a class="headerlink" href="#part-b-odd-temporal-distribution" title="Permalink to this headline">¶</a></h2>
<p>Accidentally, the numbers of parallel processes used in Part A are always dividers of the number of steps.
Yet, this does not need to be the case. All controllers are capable of handling odd distributions, e.g. too few or too many processes for the steps (or for the las block).
This is demonstrated here, where the code from Part A is called again with odd number of parallel steps.</p>
<p>Important things to note:</p>
<ul class="simple">
<li>This capability may become useful if adaptive time-stepping is used. The controllers check for currently active steps and only those will compute the next block.</li>
<li>This also works for/with SDC and MLSDC, where in the case of varying time-step sizes the overall number of steps is not given at the beginning.</li>
</ul>
<p>Full code: <a class="reference external" href="https://github.com/Parallel-in-Time/pySDC/blob/master/pySDC/tutorial/step_6/B_odd_temporal_distribution.py">pySDC/tutorial/step_6/B_odd_temporal_distribution.py</a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pySDC.tutorial.step_6.A_classic_vs_multigrid_controller</span> <span class="k">import</span> <span class="n">main</span> <span class="k">as</span> <span class="n">main_A</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A simple test program to do check PFASST for odd numbers of processes</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">main_A</span><span class="p">(</span><span class="n">num_proc_list</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">],</span> <span class="n">fname</span><span class="o">=</span><span class="s1">&#39;step_6_B_out.txt&#39;</span><span class="p">,</span> <span class="n">multi_level</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<p>Results:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Working</span> <span class="k">with</span>  <span class="mi">3</span> <span class="n">processes</span><span class="o">...</span>
<span class="n">Error</span> <span class="n">classic</span><span class="p">:</span> <span class="mf">6.15523815e-05</span>
<span class="n">Error</span> <span class="n">multigrid</span><span class="p">:</span> <span class="mf">6.15507452e-05</span>
<span class="n">Diff</span><span class="p">:</span> <span class="mf">1.6363e-09</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.00</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">5</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.12</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">5</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.25</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">5</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.38</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">4</span> <span class="o">/</span> <span class="mi">5</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.50</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">4</span> <span class="o">/</span> <span class="mi">5</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.62</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">5</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.75</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">3</span> <span class="o">/</span> <span class="mi">4</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.88</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">4</span> <span class="o">/</span> <span class="mi">4</span>

<span class="n">Working</span> <span class="k">with</span>  <span class="mi">5</span> <span class="n">processes</span><span class="o">...</span>
<span class="n">Error</span> <span class="n">classic</span><span class="p">:</span> <span class="mf">6.15511142e-05</span>
<span class="n">Error</span> <span class="n">multigrid</span><span class="p">:</span> <span class="mf">6.15507240e-05</span>
<span class="n">Diff</span><span class="p">:</span> <span class="mf">3.9019e-10</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.00</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">6</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.12</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">6</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.25</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">6</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.38</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">6</span> <span class="o">/</span> <span class="mi">6</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.50</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">6</span> <span class="o">/</span> <span class="mi">6</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.62</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">4</span> <span class="o">/</span> <span class="mi">5</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.75</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">4</span> <span class="o">/</span> <span class="mi">5</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.88</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">5</span>

<span class="n">Working</span> <span class="k">with</span>  <span class="mi">7</span> <span class="n">processes</span><span class="o">...</span>
<span class="n">Error</span> <span class="n">classic</span><span class="p">:</span> <span class="mf">6.15517411e-05</span>
<span class="n">Error</span> <span class="n">multigrid</span><span class="p">:</span> <span class="mf">6.15508148e-05</span>
<span class="n">Diff</span><span class="p">:</span> <span class="mf">9.2639e-10</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.00</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">7</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.12</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">7</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.25</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">7</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.38</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">6</span> <span class="o">/</span> <span class="mi">7</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.50</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">6</span> <span class="o">/</span> <span class="mi">7</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.62</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">6</span> <span class="o">/</span> <span class="mi">7</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.75</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">6</span> <span class="o">/</span> <span class="mi">7</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.88</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">3</span> <span class="o">/</span> <span class="mi">3</span>

<span class="n">Working</span> <span class="k">with</span>  <span class="mi">9</span> <span class="n">processes</span><span class="o">...</span>
<span class="n">Error</span> <span class="n">classic</span><span class="p">:</span> <span class="mf">6.15540230e-05</span>
<span class="n">Error</span> <span class="n">multigrid</span><span class="p">:</span> <span class="mf">6.15508175e-05</span>
<span class="n">Diff</span><span class="p">:</span> <span class="mf">3.2055e-09</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.00</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">7</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.12</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">7</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.25</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">7</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.38</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">6</span> <span class="o">/</span> <span class="mi">7</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.50</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">6</span> <span class="o">/</span> <span class="mi">7</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.62</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">6</span> <span class="o">/</span> <span class="mi">7</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.75</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">6</span> <span class="o">/</span> <span class="mi">7</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.88</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">7</span> <span class="o">/</span> <span class="mi">7</span>

</pre></div>
</div>
</div>
<div class="section" id="part-c-mpi-parallelization">
<h2>Part C: MPI parallelization<a class="headerlink" href="#part-c-mpi-parallelization" title="Permalink to this headline">¶</a></h2>
<p>Since PFASST is actually a parallel algorithm, executing it in parallel e.g. using MPI might be an interesting exercise.
To do this, pySDC comes with the two MPI-parallelized controllers, namely <code class="docutils literal notranslate"><span class="pre">allinclusive_classic_MPI</span></code> and <code class="docutils literal notranslate"><span class="pre">allinclusive_multigrid_MPI</span></code>.
Both are supposed to yield the same results as their non-MPI counterparts and this is what we are demonstrating here (at least for one particular example).
The actual code of this part is rather short, since the only task is to call another snippet (<code class="docutils literal notranslate"><span class="pre">playground_parallelization.py</span></code>) with different number of parallel processes.
This is realized using Python’s <code class="docutils literal notranslate"><span class="pre">subprocess</span></code> library and we check at the end if each call returned normally.
Now, the snippet called by the example is the basically the same code as use by Parts A and B.
We can use the results of Parts A and B to compare with and we expect the same number of iterations, the same accuracy and the same difference between the two flavors as in Part A (up to machine precision).</p>
<p>Important things to note:</p>
<ul class="simple">
<li>The additional Python script <code class="docutils literal notranslate"><span class="pre">playground_parallelization.py</span></code> contains the code to run the MPI-parallel controllers. To this end, we import the routine <code class="docutils literal notranslate"><span class="pre">set_parameters</span></code> from Part A to ensure that we use teh same set of parameters for all runs.</li>
<li>This example also shows how the statistics of multiple MPI processes can be gathered and processed by rank 0, see <code class="docutils literal notranslate"><span class="pre">playground_parallelization.py</span></code>.</li>
<li>Both controllers need a working installation of <code class="docutils literal notranslate"><span class="pre">mpi4py</span></code>. Since this is not always easy to achieve and since debugging a parallel program can cause a lot of headaches, the non-MPI controllers perform the same operations in serial.</li>
<li>The somewhat weird notation with the current working directory <code class="docutils literal notranslate"><span class="pre">cwd</span></code> is due to the corresponding test, which, run by nosetests, has a different working directory than the tutorial.</li>
</ul>
<p>Full code: <a class="reference external" href="https://github.com/Parallel-in-Time/pySDC/blob/master/pySDC/tutorial/step_6/C_MPI_parallelization.py">pySDC/tutorial/step_6/C_MPI_parallelization.py</a> and
<a class="reference external" href="https://github.com/Parallel-in-Time/pySDC/blob/master/pySDC/tutorial/step_6/playground_parallelization.py">pySDC/tutorial/step_6/playground_parallelization.py</a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">os</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">cwd</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A simple test program to test MPI-parallel PFASST controllers</span>
<span class="sd">    Args:</span>
<span class="sd">        cwd: current working directory</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Set python path once</span>
    <span class="n">my_env</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">my_env</span><span class="p">[</span><span class="s1">&#39;PYTHONPATH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;../../..:.&#39;</span>

    <span class="c1"># set list of number of parallel steps (even)</span>
    <span class="n">num_procs_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span>

    <span class="c1"># set up new/empty file for output</span>
    <span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;step_6_C1_out.txt&#39;</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">cwd</span> <span class="o">+</span> <span class="s1">&#39;/../../../&#39;</span> <span class="o">+</span> <span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="c1"># run code with different number of MPI processes</span>
    <span class="k">for</span> <span class="n">num_procs</span> <span class="ow">in</span> <span class="n">num_procs_list</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Running code with </span><span class="si">%2i</span><span class="s1"> processes...&#39;</span> <span class="o">%</span> <span class="n">num_procs</span><span class="p">)</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;mpirun -np &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num_procs</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; python playground_parallelization.py ../../../&#39;</span> <span class="o">+</span> <span class="n">fname</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">env</span><span class="o">=</span><span class="n">my_env</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">cwd</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">p</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;ERROR: did not get return code 0, got </span><span class="si">%s</span><span class="s1"> with </span><span class="si">%2i</span><span class="s1"> processes&#39;</span> <span class="o">%</span> \
                                  <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">returncode</span><span class="p">,</span> <span class="n">num_procs</span><span class="p">)</span>

    <span class="c1"># set list of number of parallel steps (odd)</span>
    <span class="n">num_procs_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span>

    <span class="c1"># set up new/empty file for output</span>
    <span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;step_6_C2_out.txt&#39;</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">cwd</span> <span class="o">+</span> <span class="s1">&#39;/../../../&#39;</span> <span class="o">+</span> <span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="c1"># run code with different number of MPI processes</span>
    <span class="k">for</span> <span class="n">num_procs</span> <span class="ow">in</span> <span class="n">num_procs_list</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Running code with </span><span class="si">%2i</span><span class="s1"> processes...&#39;</span> <span class="o">%</span> <span class="n">num_procs</span><span class="p">)</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;mpirun -np &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num_procs</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; python playground_parallelization.py ../../../&#39;</span> <span class="o">+</span> <span class="n">fname</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">env</span><span class="o">=</span><span class="n">my_env</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">cwd</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">p</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;ERROR: did not get return code 0, got </span><span class="si">%s</span><span class="s1"> with </span><span class="si">%2i</span><span class="s1"> processes&#39;</span> <span class="o">%</span> \
                                  <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">returncode</span><span class="p">,</span> <span class="n">num_procs</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mpi4py</span> <span class="k">import</span> <span class="n">MPI</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">from</span> <span class="nn">pySDC.implementations.controller_classes.allinclusive_classic_MPI</span> <span class="k">import</span> <span class="n">allinclusive_classic_MPI</span>
<span class="kn">from</span> <span class="nn">pySDC.implementations.controller_classes.allinclusive_multigrid_MPI</span> <span class="k">import</span> <span class="n">allinclusive_multigrid_MPI</span>

<span class="kn">from</span> <span class="nn">pySDC.helpers.stats_helper</span> <span class="k">import</span> <span class="n">filter_stats</span><span class="p">,</span> <span class="n">sort_stats</span>
<span class="kn">from</span> <span class="nn">pySDC.tutorial.step_6.A_classic_vs_multigrid_controller</span> <span class="k">import</span> <span class="n">set_parameters_ml</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A simple test program to do MPI-parallel PFASST runs</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># set MPI communicator</span>
    <span class="n">comm</span> <span class="o">=</span> <span class="n">MPI</span><span class="o">.</span><span class="n">COMM_WORLD</span>

    <span class="c1"># get parameters from Part A</span>
    <span class="n">description</span><span class="p">,</span> <span class="n">controller_params</span><span class="p">,</span> <span class="n">t0</span><span class="p">,</span> <span class="n">Tend</span> <span class="o">=</span> <span class="n">set_parameters_ml</span><span class="p">()</span>

    <span class="c1"># instantiate controllers</span>
    <span class="n">controller_classic</span> <span class="o">=</span> <span class="n">allinclusive_classic_MPI</span><span class="p">(</span><span class="n">controller_params</span><span class="o">=</span><span class="n">controller_params</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span>
                                                  <span class="n">comm</span><span class="o">=</span><span class="n">comm</span><span class="p">)</span>
    <span class="n">controller_multigrid</span> <span class="o">=</span> <span class="n">allinclusive_multigrid_MPI</span><span class="p">(</span><span class="n">controller_params</span><span class="o">=</span><span class="n">controller_params</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span>
                                                      <span class="n">comm</span><span class="o">=</span><span class="n">comm</span><span class="p">)</span>
    <span class="c1"># get initial values on finest level</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">controller_classic</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">levels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">prob</span>
    <span class="n">uinit</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">u_exact</span><span class="p">(</span><span class="n">t0</span><span class="p">)</span>

    <span class="c1"># call main functions to get things done...</span>
    <span class="n">uend_classic</span><span class="p">,</span> <span class="n">stats_classic</span> <span class="o">=</span> <span class="n">controller_classic</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">u0</span><span class="o">=</span><span class="n">uinit</span><span class="p">,</span> <span class="n">t0</span><span class="o">=</span><span class="n">t0</span><span class="p">,</span> <span class="n">Tend</span><span class="o">=</span><span class="n">Tend</span><span class="p">)</span>
    <span class="n">uend_multigrid</span><span class="p">,</span> <span class="n">stats_multigrid</span> <span class="o">=</span> <span class="n">controller_multigrid</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">u0</span><span class="o">=</span><span class="n">uinit</span><span class="p">,</span> <span class="n">t0</span><span class="o">=</span><span class="n">t0</span><span class="p">,</span> <span class="n">Tend</span><span class="o">=</span><span class="n">Tend</span><span class="p">)</span>

    <span class="c1"># filter statistics by type (number of iterations)</span>
    <span class="n">filtered_stats_classic</span> <span class="o">=</span> <span class="n">filter_stats</span><span class="p">(</span><span class="n">stats_classic</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;niter&#39;</span><span class="p">)</span>
    <span class="n">filtered_stats_multigrid</span> <span class="o">=</span> <span class="n">filter_stats</span><span class="p">(</span><span class="n">stats_multigrid</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;niter&#39;</span><span class="p">)</span>

    <span class="c1"># convert filtered statistics to list of iterations count, sorted by process</span>
    <span class="n">iter_counts_classic</span> <span class="o">=</span> <span class="n">sort_stats</span><span class="p">(</span><span class="n">filtered_stats_classic</span><span class="p">,</span> <span class="n">sortby</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
    <span class="n">iter_counts_multigrid</span> <span class="o">=</span> <span class="n">sort_stats</span><span class="p">(</span><span class="n">filtered_stats_multigrid</span><span class="p">,</span> <span class="n">sortby</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>

    <span class="c1"># combine statistics into list of statistics</span>
    <span class="n">iter_counts_classic_list</span> <span class="o">=</span> <span class="n">comm</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">iter_counts_classic</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">iter_counts_multigrid_list</span> <span class="o">=</span> <span class="n">comm</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">iter_counts_multigrid</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">rank</span> <span class="o">=</span> <span class="n">comm</span><span class="o">.</span><span class="n">Get_rank</span><span class="p">()</span>
    <span class="n">size</span> <span class="o">=</span> <span class="n">comm</span><span class="o">.</span><span class="n">Get_size</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">rank</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>

        <span class="c1"># we&#39;d need to deal with variable file names here (for testing purpose only)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">fname</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;step_6_B_out.txt&#39;</span>

        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;Working with </span><span class="si">%2i</span><span class="s1"> processes...&#39;</span> <span class="o">%</span> <span class="n">size</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>

        <span class="c1"># compute exact solutions and compare with both results</span>
        <span class="n">uex</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">u_exact</span><span class="p">(</span><span class="n">Tend</span><span class="p">)</span>
        <span class="n">err_classic</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">uex</span> <span class="o">-</span> <span class="n">uend_classic</span><span class="p">)</span>
        <span class="n">err_multigrid</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">uex</span> <span class="o">-</span> <span class="n">uend_multigrid</span><span class="p">)</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">uend_classic</span> <span class="o">-</span> <span class="n">uend_multigrid</span><span class="p">)</span>

        <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;Error classic: </span><span class="si">%12.8e</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">err_classic</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;Error multigrid: </span><span class="si">%12.8e</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">err_multigrid</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;Diff: </span><span class="si">%6.4e</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">diff</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>

        <span class="c1"># build one list of statistics instead of list of lists, the sort by time</span>
        <span class="n">iter_counts_gather</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">iter_counts_classic_list</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]</span>
        <span class="n">iter_counts_classic</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">iter_counts_gather</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">tup</span><span class="p">:</span> <span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">iter_counts_gather</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">iter_counts_multigrid_list</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]</span>
        <span class="n">iter_counts_multigrid</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">iter_counts_gather</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">tup</span><span class="p">:</span> <span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="c1"># compute and print statistics</span>
        <span class="k">for</span> <span class="n">item_classic</span><span class="p">,</span> <span class="n">item_multigrid</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">iter_counts_classic</span><span class="p">,</span> <span class="n">iter_counts_multigrid</span><span class="p">):</span>
            <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;Number of iterations for time </span><span class="si">%4.2f</span><span class="s1"> (classic/multigrid): </span><span class="si">%1i</span><span class="s1"> / </span><span class="si">%1i</span><span class="s1">&#39;</span> <span class="o">%</span> \
                  <span class="p">(</span><span class="n">item_classic</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">item_classic</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">item_multigrid</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>

        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">()</span>

        <span class="k">assert</span> <span class="nb">all</span><span class="p">([</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">8</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">iter_counts_multigrid</span><span class="p">]),</span> \
            <span class="s2">&quot;ERROR: weird iteration counts for multigrid, got </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">iter_counts_multigrid</span>
        <span class="k">assert</span> <span class="n">diff</span> <span class="o">&lt;</span> <span class="mf">3.5E-09</span><span class="p">,</span> \
            <span class="s2">&quot;ERROR: difference between classic and multigrid controller is too large, got </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">diff</span>
</pre></div>
</div>
<p>Results:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Working</span> <span class="k">with</span>  <span class="mi">1</span> <span class="n">processes</span><span class="o">...</span>
<span class="n">Error</span> <span class="n">classic</span><span class="p">:</span> <span class="mf">6.15508919e-05</span>
<span class="n">Error</span> <span class="n">multigrid</span><span class="p">:</span> <span class="mf">6.15508919e-05</span>
<span class="n">Diff</span><span class="p">:</span> <span class="mf">0.0000e+00</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.00</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">5</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.12</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">5</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.25</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">4</span> <span class="o">/</span> <span class="mi">4</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.38</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">4</span> <span class="o">/</span> <span class="mi">4</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.50</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">4</span> <span class="o">/</span> <span class="mi">4</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.62</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">4</span> <span class="o">/</span> <span class="mi">4</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.75</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">3</span> <span class="o">/</span> <span class="mi">3</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.88</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">3</span> <span class="o">/</span> <span class="mi">3</span>

<span class="n">Working</span> <span class="k">with</span>  <span class="mi">2</span> <span class="n">processes</span><span class="o">...</span>
<span class="n">Error</span> <span class="n">classic</span><span class="p">:</span> <span class="mf">6.15520691e-05</span>
<span class="n">Error</span> <span class="n">multigrid</span><span class="p">:</span> <span class="mf">6.15507639e-05</span>
<span class="n">Diff</span><span class="p">:</span> <span class="mf">1.3052e-09</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.00</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">5</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.12</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">5</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.25</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">4</span> <span class="o">/</span> <span class="mi">5</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.38</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">5</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.50</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">4</span> <span class="o">/</span> <span class="mi">4</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.62</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">4</span> <span class="o">/</span> <span class="mi">4</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.75</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">3</span> <span class="o">/</span> <span class="mi">4</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.88</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">4</span> <span class="o">/</span> <span class="mi">4</span>

<span class="n">Working</span> <span class="k">with</span>  <span class="mi">4</span> <span class="n">processes</span><span class="o">...</span>
<span class="n">Error</span> <span class="n">classic</span><span class="p">:</span> <span class="mf">6.15511879e-05</span>
<span class="n">Error</span> <span class="n">multigrid</span><span class="p">:</span> <span class="mf">6.15508277e-05</span>
<span class="n">Diff</span><span class="p">:</span> <span class="mf">3.6024e-10</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.00</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">6</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.12</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">6</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.25</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">6</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.38</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">6</span> <span class="o">/</span> <span class="mi">6</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.50</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">4</span> <span class="o">/</span> <span class="mi">5</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.62</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">4</span> <span class="o">/</span> <span class="mi">5</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.75</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">5</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.88</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">5</span>

<span class="n">Working</span> <span class="k">with</span>  <span class="mi">8</span> <span class="n">processes</span><span class="o">...</span>
<span class="n">Error</span> <span class="n">classic</span><span class="p">:</span> <span class="mf">6.15540230e-05</span>
<span class="n">Error</span> <span class="n">multigrid</span><span class="p">:</span> <span class="mf">6.15508175e-05</span>
<span class="n">Diff</span><span class="p">:</span> <span class="mf">3.2055e-09</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.00</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">7</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.12</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">7</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.25</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">7</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.38</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">6</span> <span class="o">/</span> <span class="mi">7</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.50</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">6</span> <span class="o">/</span> <span class="mi">7</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.62</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">6</span> <span class="o">/</span> <span class="mi">7</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.75</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">6</span> <span class="o">/</span> <span class="mi">7</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.88</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">7</span> <span class="o">/</span> <span class="mi">7</span>

</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Working</span> <span class="k">with</span>  <span class="mi">3</span> <span class="n">processes</span><span class="o">...</span>
<span class="n">Error</span> <span class="n">classic</span><span class="p">:</span> <span class="mf">6.15523815e-05</span>
<span class="n">Error</span> <span class="n">multigrid</span><span class="p">:</span> <span class="mf">6.15507452e-05</span>
<span class="n">Diff</span><span class="p">:</span> <span class="mf">1.6363e-09</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.00</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">5</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.12</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">5</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.25</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">5</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.38</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">4</span> <span class="o">/</span> <span class="mi">5</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.50</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">4</span> <span class="o">/</span> <span class="mi">5</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.62</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">5</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.75</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">3</span> <span class="o">/</span> <span class="mi">4</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.88</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">4</span> <span class="o">/</span> <span class="mi">4</span>

<span class="n">Working</span> <span class="k">with</span>  <span class="mi">5</span> <span class="n">processes</span><span class="o">...</span>
<span class="n">Error</span> <span class="n">classic</span><span class="p">:</span> <span class="mf">6.15511142e-05</span>
<span class="n">Error</span> <span class="n">multigrid</span><span class="p">:</span> <span class="mf">6.15507240e-05</span>
<span class="n">Diff</span><span class="p">:</span> <span class="mf">3.9019e-10</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.00</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">6</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.12</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">6</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.25</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">6</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.38</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">6</span> <span class="o">/</span> <span class="mi">6</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.50</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">6</span> <span class="o">/</span> <span class="mi">6</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.62</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">4</span> <span class="o">/</span> <span class="mi">5</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.75</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">4</span> <span class="o">/</span> <span class="mi">5</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.88</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">5</span>

<span class="n">Working</span> <span class="k">with</span>  <span class="mi">7</span> <span class="n">processes</span><span class="o">...</span>
<span class="n">Error</span> <span class="n">classic</span><span class="p">:</span> <span class="mf">6.15517411e-05</span>
<span class="n">Error</span> <span class="n">multigrid</span><span class="p">:</span> <span class="mf">6.15508148e-05</span>
<span class="n">Diff</span><span class="p">:</span> <span class="mf">9.2639e-10</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.00</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">7</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.12</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">7</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.25</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">7</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.38</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">6</span> <span class="o">/</span> <span class="mi">7</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.50</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">6</span> <span class="o">/</span> <span class="mi">7</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.62</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">6</span> <span class="o">/</span> <span class="mi">7</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.75</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">6</span> <span class="o">/</span> <span class="mi">7</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.88</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">3</span> <span class="o">/</span> <span class="mi">3</span>

<span class="n">Working</span> <span class="k">with</span>  <span class="mi">9</span> <span class="n">processes</span><span class="o">...</span>
<span class="n">Error</span> <span class="n">classic</span><span class="p">:</span> <span class="mf">6.15540230e-05</span>
<span class="n">Error</span> <span class="n">multigrid</span><span class="p">:</span> <span class="mf">6.15508175e-05</span>
<span class="n">Diff</span><span class="p">:</span> <span class="mf">3.2055e-09</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.00</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">7</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.12</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">7</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.25</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">7</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.38</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">6</span> <span class="o">/</span> <span class="mi">7</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.50</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">6</span> <span class="o">/</span> <span class="mi">7</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.62</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">6</span> <span class="o">/</span> <span class="mi">7</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.75</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">6</span> <span class="o">/</span> <span class="mi">7</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.88</span> <span class="p">(</span><span class="n">classic</span><span class="o">/</span><span class="n">multigrid</span><span class="p">):</span> <span class="mi">7</span> <span class="o">/</span> <span class="mi">7</span>

</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Step-6: Advanced PFASST controllers</a><ul>
<li><a class="reference internal" href="#part-a-classical-vs-multigrid-controller">Part A: Classical vs. multigrid controller</a></li>
<li><a class="reference internal" href="#part-b-odd-temporal-distribution">Part B: Odd temporal distribution</a></li>
<li><a class="reference internal" href="#part-c-mpi-parallelization">Part C: MPI parallelization</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="step_5.html"
                        title="previous chapter">Step-5: PFASST</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="step_7.html"
                        title="next chapter">Step-7: Advanced topics</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/tutorial/step_6.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="step_7.html" title="Step-7: Advanced topics"
             >next</a> |</li>
        <li class="right" >
          <a href="step_5.html" title="Step-5: PFASST"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">pySDC 2 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, Robert Speck.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.5.
    </div>
  </body>
</html>